# --- BASIC OPTIONS ---
set -g default-shell "/bin/bash"
set-option -g set-clipboard on # !allows clipboard access in nvim
set -g mouse on
set -g base-index 1
set -g renumber-windows on
set -g mode-keys vi
set-option -g status-style 'bg=black'
set-option -g status-right "%H:%M %d-%b"
set-option -g pane-active-border-style bg=orange # better active pane indicator
set-option -g focus-events on
set -g status-interval 20
set -g status-right "󰃭 %m-%d | #[fg=yellow]󱑎 %H:%M "
set -g status-right-length 80
set -g status-right "#[fg=gray]dsk: #(df -h / | awk 'NR==2 {print $5}') | #[fg=green]cpu #(top -bn1 | grep 'Cpu(s)' | awk '{print $2}')% | mem #(free -m | awk '/Mem/ {printf \"%.1f%%\", $3/$2*100}') | #[fg=magenta]vol: #(wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -q 'MUTED' && echo '#[fg=red]MUTED' || wpctl get-volume @DEFAULT_AUDIO_SINK@ | awk '{print $2 * 100 \"%%\"}') | #[fg=gray]󰃭 %m.%d | #[fg=yellow]󱑎 %H:%M "

set-option -g status-position top
set-window-option -g window-status-current-format '|#I:#W #F|'
set-window-option -g window-status-current-style 'fg=black,bg=colour158,bold'

# CONNECT TO WAYLAND
set-environment -g XDG_RUNTIME_DIR "$XDG_RUNTIME_DIR"
set-environment -g HYPRLAND_INSTANCE_SIGNATURE ea444c35002306€34505ab6753e069ae7801cc25_1767074722_1144034251
set-environment -g WAYLAND_DISPLAY wayland-1

# KEYBINDS
unbind-key -n C-h # ctrl bspc escapes neovim in normal mode
bind a source-file ~/.tmux.conf \; display-message "tmux config reloaded"
bind -n M-t popup -w 90% -h 90% -d "#{pane_current_path}"
bind -n M-c last-pane
bind -n M-Space resize-pane -Z
bind -n M-i previous-window
bind -n C-Tab next-window
bind -n M-c run-shell '
  panes=$(tmux list-panes | wc -l)
  zoomed=$(tmux display-message -p "#{window_zoomed_flag}")

  if [ "$panes" -eq 1 ]; then
      tmux split-window -h
  elif [ "$zoomed" -eq 1 ]; then
      tmux last-pane \; resize-pane -Z
  else
      tmux last-pane
  fi'

# AUTO RESTORE TMUX LAST SESSION
set-hook -g client-attached '
  if-shell "[ ! -f /tmp/tmux-restored ] && [ -f ~/.local/share/tmux/resurrect/last ]" \
     run-shell ~/.tmux/plugins/tmux-resurrect/scripts/restore.sh"
'
# --- Plugins ---
set -g @tpm_plugins "tmux-plugins/tpm \
  tmux-plugins/tmux-resurrect"

# Initialize TPM (plugin manager)
run -b "~/.tmux/plugins/tpm/tpm"
